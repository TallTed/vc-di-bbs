<!DOCTYPE html>
<html>
  <head>
    <title>BBS Cryptosuite v2023</title>
    <meta http-equiv='Content-Type' content='text/html;charset=utf-8'/>
    <!--
      === NOTA BENE ===
      For the three scripts below, if your spec resides on dev.w3 you can check them
      out in the same tree and use relative links so that they'll work offline,
     -->
    <script src='https://www.w3.org/Tools/respec/respec-w3c' class='remove'></script>
    <script class='remove' src="https://w3c.github.io/vc-data-integrity/common.js"></script>

    <script type="text/javascript" class="remove">
      var respecConfig = {
        // specification status (e.g. WD, LCWD, NOTE, etc.). If in doubt use ED.
        specStatus:           "ED",

        // the specification's short name, as in http://www.w3.org/TR/short-name/
        shortName: "vc-di-bbs",
        subtitle: "Achieving Data Integrity using Unlinkable BBS Signatures",
        group: "vc",
        // latestVersion: "https://www.w3.org/community/reports/credentials/CG-FINAL-vc-di-bbs-20230405/",

        // if you wish the publication date to be other than today, set this
        // publishDate:  "2009-08-06",

        // if there is a previously published draft, uncomment this and set its YYYY-MM-DD date
        // and its maturity status
        // previousPublishDate:  "1977-03-15",
        // previousMaturity:  "WD",

        // if there a publicly available Editor's Draft, this is the link
        edDraftURI:           "https://w3c.github.io/vc-di-bbs/",

        // if this is a LCWD, uncomment and set the end of its review period
        // lcEnd: "2009-08-05",

        // if you want to have extra CSS, append them to this list
        // it is recommended that the respec.css stylesheet be kept
        //extraCSS:             ["spec.css", "prettify.css"],

        // editors, add as many as you like
        // only "name" is required
        editors:  [
          { name: "Tobias Looker", url: "https://mattr.global/",
            company: "Mattr", companyURL: "https://mattr.global/" },
          { name: "Orie Steele", url: "https://transmute.industries",
            company: "Transmute", companyURL: "https://transmute.industries" }
        ],

        // extend the bibliography entries
        //localBiblio: webpayments.localBiblio,

        // wg:           "Verifiable Credentials Working Group Group",
        // URI of the public WG page
        // wgURI:        "https://www.w3.org/community/credentials/",
        // name (with the @w3c.org) of the public mailing to which comments are due
        // wgPublicList: "public-credentials",
        // URI of the patent status for this WG, for Rec-track documents
        // !!!! IMPORTANT !!!!
        // This is important for Rec-track documents, do not copy a patent URI from a random
        // document unless you know what you're doing. If in doubt ask your friendly neighbourhood
        // Team Contact.
        // wgPatentURI:  "https://www.w3.org/community/about/agreements/cla/",

        otherLinks: [{
          key: "Source control",
          data: [{
            value: "https://github.com/w3c/vc-di-bbs/",
            href: "https://github.com/w3c/vc-di-bbs/"
          }]
        }, {
          key: "Issue Tracker",
          data: [{
            value: "https://github.com/w3c/vc-di-bbs/issues/",
            href: "https://github.com/w3c/vc-di-bbs/issues/"
          }]
        }],

        // URI of the patent status for this WG, for Rec-track documents
        // !!!! IMPORTANT !!!!
        // This is important for Rec-track documents, do not copy a patent URI from a random
        // document unless you know what you're doing. If in doubt ask your friendly neighbourhood
        // Team Contact.
        // wgPatentURI:  "",
        maxTocLevel: 4,
        /*preProcess: [ webpayments.preProcess ],
        alternateFormats: [ {uri: "diff-20111214.html", label: "diff to previous version"} ],
        */
        localBiblio:  {
          "RDF-DATASET-NORMALIZATION": {
            title:    "RDF Dataset Normalization 1.0",
            href:     "http://json-ld.github.io/normalization/spec/",
            authors:  ["David Longley", "Manu Sporny"],
            status:   "CGDRAFT",
            publisher:  "JSON-LD Community Group"
          },
          "RDF-CONCEPTS": {
            title:    "RDF 1.1 Concepts and Abstract Syntax",
            href:     "https://www.w3.org/TR/rdf11-concepts/",
            authors:  ["Richard Cyganiak", "David Wood", "Markus Lanthaler"],
            status:   "Recommendation",
            publisher:  "W3C"
          },
          "RDF-N-Quads": {
            title:    "RDF 1.1 N-Quads",
            href:     "http://json-ld.github.io/normalization/spec/",
            authors:  ["Gaven Carothers"],
            status:   "Recommendation",
          },
          "SECURITY-VOCABULARY": {
            title:    "Security Linked Data Vocabulary",
            href:     "https://web-payments.org/vocabs/security",
            authors:  ["Manu Sporny","David Longley"],
            status:   "CGDRAFT",
            publisher:  "Web Payments Community Group"
          },
          "DATA-INTEGRITY": {
            title:    "Data Integrity 1.0",
            href:     "https://w3c-ccg.github.io/data-integrity-spec/",
            authors:  ["David Longley", "Manu Sporny"],
            status:   "CGDRAFT",
            publisher:  "Credentials Community Group"
          },
          "JSON-LD-FRAMING": {
            title:    "JSON-LD 1.1 Framing",
            href:     "https://www.w3.org/TR/json-ld11-framing",
            authors:  ["Dave Longley", "Gregg Kellogg", "Pierre-Antoine Champin"],
            status:   "Candidate Recommendation",
            publisher:  "W3C"
          },
          "JSON-LD": {
            title:    "JSON-LD 1.1",
            href:     "https://www.w3.org/TR/json-ld11",
            authors:  ["Dave Longley", "Gregg Kellogg", "Pierre-Antoine Champin"],
            status:   "Candidate Recommendation",
            publisher:  "W3C"
          },
          "PAIRING-FRIENDLY-CURVES": {
            title:    "Pairing-Friendly Curves",
            href:     "https://tools.ietf.org/html/draft-irtf-cfrg-pairing-friendly-curves-03",
            authors:  ["Yumi Sakemi", "Tetsutaro Kobayashi", "Tsunekazu Saito"],
            status:   "Internet Draft",
            publisher:  "IETF"
          },
          "VC-DATA-MODEL-2": {
            title: "Verifiable Credentials Data Model v2.0",
            href: "https://www.w3.org/TR/vc-data-model-2.0/",
            authors: [
              "Manu Sporny", "Dave Longley", "Grant Noble", "Dan Burnett",
              "Ted Thibodeau", "Brent Zundel", "David Chadwick",
              "Kyle Den Hartog"
            ],
            status: "Working Draft",
            publisher: "W3C Verifiable Credentials Working Group"
          },
          "SHORT-GROUP-SIGNATURES": {
            title:    "Short group signatures",
            href:     "https://crypto.stanford.edu/~xb/crypto04a/groupsigs.pdf",
            authors:  ["Dan Boneh", "Xavier Boyen", "Hovav Shacham"],
            status:   "Published",
            publisher:  "Advances in Cryptologyâ€”CRYPTO 2004"
          },
          MULTIBASE: {
            title: "Multibase",
            href: "https://tools.ietf.org/html/draft-multiformats-multibase-01",
          },
          MULTICODEC: {
            title: "Multicodec",
            href: "https://github.com/multiformats/multicodec/",
          },
          "CFRG-BBS-SIGNATURE": {
            title:    "The BBS Signature Scheme",
            href:     "https://www.ietf.org/archive/id/draft-irtf-cfrg-bbs-signatures-02.html",
            authors:  ["Tobias Looker", "Vasilis Kalos", "Andrew Whitehead", "Mike Lodder"],
            status:   "Draft"
          },
          "BBS": {
            title:    "BBS+ Signatures",
            href:     "https://mattrglobal.github.io/bbs-signatures-spec/",
            authors:  ["Michael Lodder", "Tobias Looker"],
            status:   "Draft"
          },
          "BLAKE2": {
            title:    "Blake2 - fast secure hashing",
            href:     "https://www.blake2.net/",
          }
        },
        lint: {"no-unused-dfns": false},
        postProcess: [restrictRefs]
      };
    </script>
        <style>
          pre .highlight {
            font-weight: bold;
            color: green;
          }
          pre .comment {
            font-weight: bold;
            color: Gray;
          }
          .color-text {
            font-weight: bold;
            text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black;
          }
          ol.algorithm {
            counter-reset: numsection;
            list-style-type: none;
          }
          ol.algorithm li {
            margin: 0.5em 0;
          }
          ol.algorithm li:before {
            font-weight: bold;
            counter-increment: numsection;
            content: counters(numsection, ".") ") ";
          }
              </style>
  </head>
  <body>
    <section id='abstract'>
      <p>
This specification describes the BBS+ Signature Suite created in 2020
for the Data Integrity specification. The Signature Suite utilizes
BBS+ signatures to provide the capability of zero knowledge
proof disclosures.
      </p>
    </section>

    <section id='sotd'>
      <p>
This is an experimental specification and is undergoing regular revisions. It
is not fit for production deployment.
      </p>
    </section>

    <section>
      <h2>Introduction</h2>
      <p>
This specification defines a set of cryptographic suites for the purpose of creating, verifying and deriving proofs
for BBS+ Signatures in conformance with the Data Integrity [[DATA-INTEGRITY]] specification.
      </p>
      <p>
In general the suites uses the RDF Dataset Normalization Algorithm [[RDF-DATASET-NORMALIZATION]] to transform an
input document into its canonical form. It then uses the <a>statement digest algorithm</a>
to digest each statement to be signed individually, finally the digested statements are signed
using the defined <a>signature algorithm</a>.
      </p>
      <p>
BBS+ signatures [[BBS]] are compatible with any pairing friendly elliptic curve, however the cryptographic
suites defined in this document elect to only allow the usage of the BLS12-381 for interoperability purposes.
      </p>

    <section>
      <h2>Terminology</h2>
      <p>
The following terms are used to describe concepts involved in the
generation and verification of the Data Integrity
<a>signature suite</a>.
      </p>

      <div data-include="https://w3c.github.io/vc-data-integrity/terms.html"></div>

      <dl>
        <dt><dfn>signature suite</dfn></dt>
        <dd>
A specified set of cryptographic primitives typically consisting of
a canonicalization algorithm, a message digest algorithm, and a signature
algorithm that are bundled together by cryptographers for developers
for the purposes of safety and convenience.
        </dd>
        <dt><dfn>canonicalization algorithm</dfn></dt>
        <dd>
An algorithm that takes an input document that has more than one possible
representation and always transforms it into a <a>canonical form</a>. This process is
sometimes also called normalization.
        </dd>
        <dt><dfn>canonical form</dfn></dt>
        <dd>
The output of applying a <a>canonicalization algorithm</a> to an input document.
        </dd>
        <dt><dfn>statement</dfn></dt>
        <dd>
<a>n-quads</a> statements are a sequence of RDF terms representing the subject, predicate, object and graph label.
See the grammar definition <a href="https://www.w3.org/TR/n-quads/#grammar-production-statement">here</a>.
        </dd>
        <dt><dfn data-lt="statement digest algorithm | statement digest algorithms">statement digest algorithm</dfn></dt>
        <dd>
An algorithm that takes a <a>statement</a> and produces a cryptographic
output message that is often many orders of magnitude smaller than the
input message. These algorithms are often 1) very fast, 2)
non-reversible, 3) cause the output to change significantly when even one
bit of the input message changes, and 4) make it infeasible to find two
different inputs for the same output.
        </dd>
        <dt><dfn data-lt="statement digest | statement digests">statement digest</dfn></dt>
          <dd>
The result of the application of the <a>statement digest algorithm</a> to a <a>statement</a>
          </dd>
        <dt><dfn>signature algorithm</dfn></dt>
        <dd>
An algorithm that takes an input message and produces an output value where the
receiver of the message can mathematically verify that the message has not
been modified in transit and came from someone possessing a particular secret.
        </dd>
        <dt><dfn>selective disclosure</dfn></dt>
        <dd>
An information disclosure technique which is the process of deciding and disclosing
a sub-set of information from an original information set.
        </dd>
      <dt><dfn>data integrity proof document</dfn></dt>
      <dd>
A <a>linked data document</a> featuring one or more <a>data integrity proofs</a>.
      </dd>
      <dt><dfn data-lt="revealed statements">revealed statements</dfn></dt>
      <dd>
The set of <a>statements</a> produced by applying the <a>canonicalization algorithm</a> to the <a>reveal document</a>.
      </dd>
      <dt><dfn>derive proof algorithm</dfn></dt>
      <dd>
An algorithm that takes in a <a>data integrity proof document</a> featuring a <a>data integrity proof</a> that supports a
<a>derive proof algorithm</a> along side a <a>reveal document</a>
and derives a proof only revealing the <a>statement</a>s defined in the <a>reveal document</a>.
      </dd>
      <dt><dfn>derived proof</dfn></dt>
      <dd>
The product of apply the <a>derive proof algorithm</a> to an <a>data integrity proof document</a> and <a>reveal document</a>.
      </dd>
      <dt><dfn data-lt="quad|quads">quad</dfn></dt>
      <dd>
A <a href="https://json-ld.github.io/normalization/spec/index.html#dfn-quad" class="externalDFN">quad</a> as specified by [[RDF-DATASET-NORMALIZATION]]
      </dd>
      <dt><dfn data-lt="n-quad|n-quads">n-quad</dfn></dt>
      <dd>
An <a href="https://www.w3.org/TR/n-quads/" class="externalDFN">n-quad</a> which is a line based, plain text format encoding of a <a>quad</a> as defined by [[RDF-N-Quads]].
      </dd>
      <dt><dfn data-lt="linked data document|linked data documents">linked data document</dfn></dt>
      <dd>
A document comprised of linked data.
      </dd>
      <dt><dfn data-lt="curve name">curve name</dfn></dt>
      <dd>
The name defining a particular cryptographic curve.
      </dd>
      <dt><dfn data-lt="frame">frame</dfn></dt>
      <dd>
A <a href="https://www.w3.org/TR/json-ld11/#dfn-frame" class="externalDFN">frame</a> as specified by [[JSON-LD-FRAMING]]
is a <a>JSON-LD document</a>, which describes the form for transforming another JSON-LD
document using matching and embedding rules. A frame document allows additional
keywords and certain map entries to describe the matching and transforming process.
      </dd>
      <dt><dfn>JSON-LD document</dfn></dt>
      <dd>
A <a href="https://www.w3.org/TR/json-ld11/#dfn-json-ld-document" class="externalDFN">JSON-LD document</a> as specified by [[JSON-LD-FRAMING]]
is a is a serialization of an <a href="https://www.w3.org/TR/rdf11-concepts/#dfn-rdf-dataset">RDF dataset</a>
      </dd>
      <dt><dfn>framing algorithm</dfn></dt>
      <dd>
A <a href="https://www.w3.org/TR/json-ld11-framing/#framing-algorithm" class="externalDFN">Framing Algorithm</a> as specified by [[JSON-LD-FRAMING]]
is an algorithm that accomplishes the process of framing an input document to a given <a>frame</a>.
      </dd>
      <dt><dfn data-lt="Blank nodes | Blank node">blank node</dfn></dt>
      <dd>
A <a href="https://www.w3.org/TR/rdf11-concepts/#dfn-blank-node" class="externalDFN">blank node</a> as specified by [[RDF-CONCEPTS]].
In short, it is a node in a graph that is neither an IRI, nor a literal.
      </dd>
      <dt><dfn>reveal document</dfn></dt>
          <dd>
    A <a>JSON-LD document</a> in the form of a <a>frame</a> which describes the desired transform to apply to the <a>input proof document</a> using
    the <a>framing algorithm</a> defined in [[JSON-LD-FRAMING]].
          </dd>

      <dt><dfn>revealed document</dfn></dt>
          <dd>
    A <a>data integrity proof document</a> which is the product of the <a>derive proof algorithm</a>.
          </dd>
      <dt><dfn>input proof document</dfn></dt>
          <dd>
    A <a>data integrity proof document</a> featuring a <a>data integrity proof</a> that supports proof derivation.
          </dd>
      </dl>
    </section>

      <section id="conformance">

      <div class="issue">TODO: Add paragraph</div>

      </section>
    </section>

    <section>
      <h2>Data Model</h2>

      <p>
The following sections outline the data model that is used by this specification
for <a>verification methods</a> and <a>data integrity proof</a> formats.
      </p>

      <section>
        <h2>Verification Methods</h2>
        <p>
The cryptographic material used to verify a <a>data integrity proof</a> is
called the <a>verification method</a>. This suite relies on public key material
represented using [[MULTIBASE]], [[MULTICODEC]], and JSON Web Key [[RFC7517]].
        </p>

        <p>
This suite MAY be used to verify Data Integrity Proofs [[VC-DATA-INTEGRITY]]
produced by BLS12-381 public key material encoded as a
<a href="#multikey">Multikey</a>. Loss-less key transformation processes that
result in equivalent cryptographic material MAY be utilized.
        </p>

        <section>
          <h3>Multikey</h3>

          <p class="issue">
This definition should go in the Data Integrity specification and referenced
from there.
          </p>

          <p>
The `type` of the verification method MUST be `Multikey`.
          </p>

          <p>
The `controller` of the verification method MUST be a URL.
          </p>

          <p>
The `publicKeyMultibase` property of the verification method MUST be a public
key encoded according to [[MULTICODEC]] and formatted according to
[[MULTIBASE]]. The multicodec encoding of a BLS12-381 public key that combines
both the G1 and G2 fields is the byte prefix `0xee` followed by the 48-byte G1
public key data, which is then followed by the 96-byte G2 public key data. The
145 byte value is then encoded using base64url with no padding (`u`) as the
prefix. Any other encodings MUST NOT be allowed.
          </p>

          <p class="advisement">
Developers are advised to not accidentally publish a representation of a private
key. Implementations of this specification will raise errors in the event of a
[[MULTICODEC]] value other than `0xee` being used in a `publicKeyMultibase`
value.
          </p>

          <pre class="example"
            title="An BLS12-381 public key containing the G1 and G2 values, encoded as a Multikey">
{
  "id": "https://example.com/issuer/123#key-0",
  "type": "Multikey",
  "controller": "https://example.com/issuer/123",
  "publicKeyMultibase": "u7ljnAxKdp7YVqJvcMU9GtnmrMc1XZztXHsTsZ2LsmGJ67SsdbmNc
    S2SDs0daEPfhVXgODk0IVrgguJ-TJACHyXYa9Ae8DaxcvRy89KLgmWsyOOJn2oY7vCE2gt
    JoebMJiQsdbmNcS2SDs0daEPfhVXgODk0IVrgguJ-TJACHyXYa9Ae8DaxcvRy89KLgm"
}
          </pre>

          <pre class="example" title="A BLS12-381 public key containing the
            G1 and G2 values, encoded as a Multikey in a controller document">
{
  "@context": [
    "https://www.w3.org/ns/did/v1",
    "https://w3id.org/security/data-integrity/v1"
  ],
  "id": "did:example:123",
  "verificationMethod": [{
    "id": "https://example.com/issuer/123#key-1",
    "type": "Multikey",
    "controller": "https://example.com/issuer/123",
    "publicKeyMultibase": "zDnaerx9CtbPJ1q36T5Ln5wYt3MQYeGRG5ehnPAmxcf5mDZpv"
  }, {
    "id": "https://example.com/issuer/123#key-2",
    "type": "Multikey",
    "controller": "https://example.com/issuer/123",
    "publicKeyMultibase": "u7ljnAxKdp7YVqJvcMU9GtnmrMc1XZztXHsTsZ2LsmGJ67SsdbmNc
      S2SDs0daEPfhVXgODk0IVrgguJ-TJACHyXYa9Ae8DaxcvRy89KLgmWsyOOJn2oY7vCE2gt
      JoebMJiQsdbmNcS2SDs0daEPfhVXgODk0IVrgguJ-TJACHyXYa9Ae8DaxcvRy89KLgm"
  }],
  "authentication": [
    "did:example:123#key-1"
  ],
  "assertionMethod": [
    "did:example:123#key-2"
  ],
  "capabilityDelegation": [
    "did:example:123#key-1"
  ],
  "capabilityInvocation": [
    "did:example:123#key-1"
  ]
}
          </pre>
        </section>

        <section>
          <h3>JsonWebKey</h3>

          <p class="issue">
This definition should go in the Data Integrity specification and referenced
from there.
          </p>

          <p>
The `type` of the verification method MUST be `JsonWebKey`.
          </p>

          <p>
The `controller` of the verification method MUST be a URL.
          </p>

          <p>
The `publicKeyJwk` property of the verification method MUST be a public
key encoded according to [[RFC7517]]. Any other encodings MUST NOT be allowed.
          </p>

          <p class="issue">
The specific encoding of BBS public key parameters are being discussed in the
JOSE Working Group.
          </p>

          <p class="advisement">
Developers are advised to not accidentally publish a representation of a private
key. Implementations of this specification MUST raise errors in the event of
the expression of a key parameter that is marked as `Private` in the IANA
JSON Web Key Parameters registry in public key information.
          </p>

          <pre class="example"
            title="An BLS12-381 public key containing the G1 and G2 values, encoded as a JsonWebKey">
{
  "id": "did:example:123#key-3",
  "type": "JsonWebKey",
  "controller": "did:example:123",
  "publicKeyJwk": [{
    "kty": "EC",
    "crv": "BLS12381_G1",
    "x": "tCgCNuUYQotPEsrljWi-lIRIPpzhqsnJV1NPnE7je6glUb-FJm9IYkuv2hbHw22i"
  }, {
    "kty": "EC",
    "crv": "BLS12381_G2",
    "x": "h_rkcTKXXzRbOPr9UxSfegCbid2U_cVNXQUaKeGF7UhwrMJFP70uMH0VQ9-3-_2zDP
      AAjflsdeLkOXW3-ShktLxuPy8UlXSNgKNmkfb-rrj-FRwbs13pv_WsIf-eV66-"
  }]
}
          </pre>

          <pre class="example" title="A BLS12-381 public key containing the
            G1 and G2 values, encoded as a JsonWebKey in a controller document">
{
  "@context": [
    "https://www.w3.org/ns/did/v1",
    "https://w3id.org/security/data-integrity/v1"
  ],
  "id": "did:example:123",
  "verificationMethod": [{
    "id": "https://example.com/issuer/123#key-3",
    "type": "Multikey",
    "controller": "https://example.com/issuer/123",
    "publicKeyMultibase": "zDnaerx9CtbPJ1q36T5Ln5wYt3MQYeGRG5ehnPAmxcf5mDZpv"
  }, {
    "id": "did:example:123#key-3",
    "type": "JsonWebKey",
    "controller": "did:example:123",
    "publicKeyJwk": [{
      "kty": "EC",
      "crv": "BLS12381_G1",
      "x": "tCgCNuUYQotPEsrljWi-lIRIPpzhqsnJV1NPnE7je6glUb-FJm9IYkuv2hbHw22i"
    }, {
      "kty": "EC",
      "crv": "BLS12381_G2",
      "x": "h_rkcTKXXzRbOPr9UxSfegCbid2U_cVNXQUaKeGF7UhwrMJFP70uMH0VQ9-3-_2zDP
        AAjflsdeLkOXW3-ShktLxuPy8UlXSNgKNmkfb-rrj-FRwbs13pv_WsIf-eV66-"
    }]
  }],
  "authentication": [
    "did:example:123#key-3"
  ],
  "assertionMethod": [
    "did:example:123#key-4"
  ],
  "capabilityDelegation": [
    "did:example:123#key-3"
  ],
  "capabilityInvocation": [
    "did:example:123#key-3"
  ]
}
          </pre>
        </section>

      </section>

    <section>
      <h2>Proof Representations</h2>

      <p>
This suite relies on detached digital signatures represented using [[MULTIBASE]]
and [[MULTICODEC]].
      </p>

      <section>
        <h3>DataIntegrityProof</h3>

        <p>
The `verificationMethod` property of the proof MUST be a URL.
Dereferencing the `verificationMethod` MUST result in an object
containing a `type` property with the value set to
`Multikey` or `JsonWebKey`.
        </p>

        <p>
The `type` property of the proof MUST be `DataIntegrityProof`.
        </p>
        <p>
The `cryptosuite` property of the proof MUST be `bbs-2023`.
        </p>
        <p>
The `created` property of the proof MUST be an [[XMLSCHEMA11-2]]
formated date string.
        </p>
        <p>
The `proofPurpose` property of the proof MUST be a string, and MUST
match the verification relationship expressed by the verification method
`controller`.
        </p>
        <p>
The `proofValue` property of the proof MUST be a detached BBS Signature
produced according to [[CFRG-BBS-SIGNATURE]], encoded according to
[[MULTIBASE]] using the base64 base encoding with no padding.
        </p>

        <pre class="example highlight" style="overflow-x:
          auto; white-space: pre-wrap; word-wrap: break-word;"
          title="An BBS digital signature expressed as a DataIntegrityProof">
{
  "@context": [
    {"title": "https://schema.org/title"},
    "https://w3id.org/security/data-integrity/v1"
  ],
  "title": "Hello world!",
  "proof": {
    "type": "DataIntegrityProof",
    "cryptosuite": "bbs-2023",
    "created": "2020-11-05T19:23:24Z",
    "verificationMethod": "https://example.com/issuer/123#key-2",
    "proofPurpose": "assertionMethod",
    "proofValue": "mU6i3dTz5yFfWJ8zgsamuyZa4yAHPm75tUOOXddR6krCvCYk77sbCOuEVcdB
      Dd/l6tIYkTTbA3pmDa6Qia/JkOnIXDLmoBz3vsi7L5t3DWySI/VLmBqleJ/Tbus5RoyiDERDB
      5rnACXlnOqJ/U8yFQFtcp/mBCc2FtKNPHae9jKIv1dm9K9QK1F3GI1AwyGoUfjLWrkGDObO1o
      AhpEd0+et+qiOf2j8p3MTTtRRx4Hgjcl0jXCq7C7R5/nLpgimHAAAAdAx4ouhMk7v9dXijCIM
      0deicn6fLoq3GcNHuH5X1j22LU/hDu7vvPnk/6JLkZ1xQAAAAIPd1tu598L/K3NSy0zOy6oba
      Enaqc1R5Ih/6ZZgfEln2a6tuUp4wePExI1DGHqwj3j2lKg31a/6bSs7SMecHBQdgIYHnBmCYG
      nu/LZ9TFV56tBXY6YOWZgFzgLDrApnrFpixEACM9rwrJ5ORtxAAAAAgE4gUIIC9aHyJNa5TBk
      Oh6ojlvQkMVLXa/vEl+3NCLXblxjgpM7UEMqBkE9/aGQcoD3Tgmy+z0hN+4elMky1RnJEhCuN
      QNsEg"
  }
}
        </pre>

      </section>
    </section>
  </section>
</section>

  <section>
    <h2>Algorithms</h2>

    <p>
The following section describes multiple Data Integrity cryptographic suites
that utilize the BBS Signature Algorithm [[CFRG-BBS-SIGNATURE]].
    </p>

    <section>
    <h3>bbs-2023</h3>

    <p>
The `bbs-2023` cryptographic suite takes an input document, canonicalizes
the document using the Universal RDF Dataset Canonicalization Algorithm
[[RDF-CANON]], and then cryptographically hashes and signs the output
resulting in the production of a data integrity proof. The algorithms in this
section also include the verification of such a data integrity proof.
    </p>

    <section>
      <h2>Add Proof (bbs-2023)</h2>

      <p>
To generate a proof, the algorithm in
<a href="https://www.w3.org/TR/vc-data-integrity/#add-proof">
Section 4.1: Add Proof</a> in the Data Integrity
[[VC-DATA-INTEGRITY]] specification MUST be executed.
For that algorithm, the cryptographic suite specific
<a href="https://www.w3.org/TR/vc-data-integrity/#dfn-transformation-algorithm">
transformation algorithm</a> is defined in Section
<a href="#transformation-bbs-2023"></a>, the
<a href="https://www.w3.org/TR/vc-data-integrity/#dfn-hashing-algorithm">
hashing algorithm</a> is defined in Section <a href="#hashing-bbs-2023"></a>,
and the
<a href="https://www.w3.org/TR/vc-data-integrity/#dfn-proof-serialization-algorithm">
proof serialization algorithm</a> is defined in Section
<a href="#proof-serialization-bbs-2023"></a>.
      </p>
    </section>

    <section>
      <h2>Verify Proof (bbs-2023)</h2>

      <p>
To verify a proof, the algorithm in
<a href="https://www.w3.org/TR/vc-data-integrity/#verify-proof">
Section 4.2: Verify Proof</a> in the Data Integrity
[[VC-DATA-INTEGRITY]] specification MUST be executed.
For that algorithm, the cryptographic suite specific
<a href="https://www.w3.org/TR/vc-data-integrity/#dfn-transformation-algorithm">
transformation algorithm</a> is defined in Section
<a href="#transformation-bbs-2023"></a>, the
<a href="https://www.w3.org/TR/vc-data-integrity/#dfn-hashing-algorithm">
hashing algorithm</a> is defined in Section <a href="#hashing-bbs-2023"></a>,
and the
<a href="https://www.w3.org/TR/vc-data-integrity/#dfn-proof-serialization-algorithm">
proof verification algorithm</a> is defined in Section
<a href="#proof-verification-bbs-2023"></a>.
      </p>
    </section>

    <section>
      <h3>Transformation (bbs-2023)</h3>

      <p>
The following algorithm specifies how to transform an unsecured input document
into a transformed document that is ready to be provided as input to the
hashing algorithm in Section <a href="#hashing-bbs-2023"></a>.
      </p>


Required inputs to this algorithm are an
<a href="https://w3c.github.io/vc-data-integrity/#dfn-unsecured-data-document">
unsecured data document</a> (<var>unsecuredDocument</var>) and
<a href="https://w3c.github.io/vc-data-integrity/#dfn-transformation-options">
transformation options</a> (<var>options</var>). The
<a href="https://w3c.github.io/vc-data-integrity/#dfn-unsecured-data-document">
transformation options</a> MUST contain a type identifier for the
<a href="https://w3c.github.io/vc-data-integrity/#dfn-cryptographic-suite">
cryptographic suite</a> (<var>type</var>) and a cryptosuite
identifier (<var>cryptosuite</var>). A <em>transformed data document</em> is
produced as output. Whenever this algorithm encodes strings, it MUST use UTF-8
encoding.
      </p>

      <ol class="algorithm">
        <li>
If <var>options</var>.<var>type</var> is not set to the string
`DataIntegrityProof` and <var>options</var>.<var>cryptosuite</var> is not
set to the string `bbs-2023` then a `PROOF_TRANSFORMATION_ERROR` MUST be
raised.
        </li>
        <li>
Let <var>canonicalDocument</var> be the result of applying the
Universal RDF Dataset Canonicalization Algorithm
[[RDF-CANON]] to the <var>unsecuredDocument</var>.
        </li>
        <li>
Set <var>output</var> to the value of <var>canonicalDocument</var>.
        </li>
        <li>
Return <var>canonicalDocument</var> as the <em>transformed data document</em>.
        </li>
      </ol>
    </section>

    <section>
      <h3>Hashing (bbs-2023)</h3>

      <p>
The following algorithm specifies how to cryptographically hash a
<em>transformed data document</em> and <em>proof configuration</em>
into cryptographic hash data that is ready to be provided as input to the
algorithms in Section <a href="#proof-serialization-bbs-2023"></a> or
Section <a href="#proof-verification-bbs-2023"></a>.
      </p>

      <p>
The required inputs to this algorithm are a <em>transformed data document</em>
(<var>transformedDocument</var>) and <em>proof configuration</em>
(<var>proofConfig</var>). A single <em>hash data</em> value represented as
series of bytes is produced as output.
      </p>

      <ol class="algorithm">
        <li class="issue">
Specify how each item in the canonicalized input is hashed and included a set
that is then signed over in <a href="#proof-serialization-bbs-2023"></a>.
        </li>
        <li class="issue">
Specify how <var>proofConfigHash</var> is generated.
        </li>
        <li class="issue">
Specify how <var>hashData</var> is composed in a way that can be signed over in
<a href="#proof-serialization-bbs-2023"></a>.
        </li>
        <li>
Return <var>hashData</var> as the <em>hash data</em>.
        </li>
      </ol>

    </section>

    <section>
      <h3>Proof Configuration (bbs-2023)</h3>

      <p>
The following algorithm specifies how to generate a
<em>proof configuration</em> from a set of <em>proof options</em>
that is used as input to the <a href="#hashing-bbs-2023">proof hashing algorithm</a>.
      </p>

      <p>
The required inputs to this algorithm are <em>proof options</em>
(<var>options</var>). The <em>proof options</em> MUST contain a type identifier
for the
<a href="https://w3c.github.io/vc-data-integrity/#dfn-cryptographic-suite">
cryptographic suite</a> (<var>type</var>) and MUST contain a cryptosuite
identifier (<var>cryptosuite</var>). A <em>proof configuration</em>
object is produced as output.
      </p>

      <ol class="algorithm">
        <li>
Let <var>proofConfig</var> be an empty object.
        </li>
        <li>
Set <var>proofConfig</var>.<var>type</var> to
<var>options</var>.<var>type</var>.
        </li>
        <li>
If <var>options</var>.<var>cryptosuite</var> is set, set
<var>proofConfig</var>.<var>cryptosuite</var> to its value.
        </li>
        <li>
If <var>options</var>.<var>type</var> is not set to `DataIntegrityProof` and
<var>proofConfig</var>.<var>cryptosuite</var> is not set to `bbs-2023`, an
`INVALID_PROOF_CONFIGURATION` error MUST be raised.
        </li>
        <li>
Set <var>proofConfig</var>.<var>created</var> to
<var>options</var>.<var>created</var>. If the value is not a valid
[[XMLSCHEMA11-2]] datetime, an `INVALID_PROOF_DATETIME` error MUST be raised.
        </li>
        <li>
Set <var>proofConfig</var>.<var>verificationMethod</var> to
<var>options</var>.<var>verificationMethod</var>.
        </li>
        <li>
Set <var>proofConfig</var>.<var>proofPurpose</var> to
<var>options</var>.<var>proofPurpose</var>.
        </li>
        <li>
Return <var>proofConfig</var>.
        </li>
      </ol>

    </section>

    <section>
      <h3>Proof Serialization (bbs-2023)</h3>

      <p>
The following algorithm specifies how to serialize a digital signature from
a set of cryptographic hash data. This
algorithm is designed to be used in conjunction with the algorithms defined
in the Data Integrity [[VC-DATA-INTEGRITY]] specification,
<a href="https://w3c.github.io/vc-data-integrity/#algorithms">
Section 4: Algorithms</a>. Required inputs are
cryptographic hash data (<var>hashData</var>) and
<em>proof options</em> (<var>options</var>). The
<em>proof options</em> MUST contain a type identifier for the
<a href="https://w3c.github.io/vc-data-integrity/#dfn-cryptographic-suite">
cryptographic suite</a> (<var>type</var>) and MAY contain a cryptosuite
identifier (<var>cryptosuite</var>). A single <em>digital proof</em> value
represented as series of bytes is produced as output.
      </p>

      <ol class="algorithm">
        <li>
Let <var>privateKeyBytes</var> be the result of retrieving the
private key bytes associated with the
<var>options</var>.<var>verificationMethod</var> value as described in the
Data Integrity [[VC-DATA-INTEGRITY]] specification,
<a href="https://w3c.github.io/vc-data-integrity/#algorithms">
Section 4: Retrieving Cryptographic Material</a>.
        </li>
        <li class="issue">
Specify how <var>proofBytes</var> is generated and consumed by Section
<a href="#proof-verification-bbs-2023"></a>.
        </li>
        <li>
Return <var>proofBytes</var> as the <em>digital proof</em>.
        </li>
      </ol>

    </section>

    <section>
      <h3>Proof Verification (bbs-2023)</h3>

      <p>
The following algorithm specifies how to verify a digital signature from
a set of cryptographic hash data. This
algorithm is designed to be used in conjunction with the algorithms defined
in the Data Integrity [[VC-DATA-INTEGRITY]] specification,
<a href="https://w3c.github.io/vc-data-integrity/#algorithms">
Section 4: Algorithms</a>. Required inputs are
cryptographic hash data (<var>hashData</var>),
a digital signature (<var>proofBytes</var>) and
proof options (<var>options</var>). A <em>verification result</em>
represented as a boolean value is produced as output.
      </p>

      <ol class="algorithm">
        <li>
Let <var>publicKeyBytes</var> be the result of retrieving the
public key bytes associated with the
<var>options</var>.<var>verificationMethod</var> value as described in the
Data Integrity [[VC-DATA-INTEGRITY]] specification,
<a href="https://w3c.github.io/vc-data-integrity/#algorithms">
Section 4: Retrieving Cryptographic Material</a>.
        </li>
        <li>
Let <var>verificationResult</var> be the result of applying the verification
algorithm defined in the BBS Signature specification [[CFRG-BBS-SIGNATURE]],
with <var>hashData</var> as the data to be verified against the
<var>proofBytes</var> using the public key specified by
<var>publicKeyBytes</var>.
        </li>
        <li>
Return <var>verificationResult</var> as the <em>verification result</em>.
        </li>
      </ol>

    </section>
  </section>
</section>

    <section>
      <h2>Security Considerations</h2>
      <p>
The following section describes security considerations that developers
implementing this specification should be aware of in order to create secure
software.
      </p>

<div class="issue">TODO: We need to add a complete list of security
considerations.</div>
    </section>

 
    <section class="appendix">
      <h2>Acknowledgements</h2>
      <p>
        Portions of the work on this specification have been funded by the
        United States Department of Homeland Security's (US DHS) Silicon Valley
        Innovation Program under contracts
        70RSAT20T00000003,
        and
        70RSAT20T00000033.
        The content of this specification does not
        necessarily reflect the position or the policy of the U.S. Government
        and no official endorsement should be inferred.
      </p>
    </section>
  </body>
</html>
